TODO
done  autoload refresh lists when the limits tab pops up

done load file from saved file does not work check file data
done save_var needs to extract just the data segment from the json



done JSON DIr = project , add version box 

consolidate load from db and export json
defer no need for limit values modal
almost done make limits values stick () does not work from the tab 

get / set on limit values
 collectLimitsForAlarm

 we need a setLimitsForAlarm whick uses collect and then puts the values back into lv.

LimitDefModal
openLimitDefModal
closeLimitDefModal

done working need to click refresh after save to see changes


 CurrentLimitsValues
lv.name
 lv.alarm_num
 lv.level1_limit
 lv.target_level1
 lv.hysteresis
 lv.target_hysteresis
 look at setLimitValue(alarmNum)
 
   collectLimitsForAlarm returns 
   return {
        alarm_num: alarmNum,
        level1_limit: Number(tr.querySelector('input[data-col="level1_limit"]').value),
        level2_limit: Number(tr.querySelector('input[data-col="level2_limit"]').value),
        level3_limit: Number(tr.querySelector('input[data-col="level3_limit"]').value),
        hysteresis: Number(tr.querySelector('input[data-col="hysteresis"]').value),
    }
    we need to set these values back into the CurentLimitsValues at the correct row number
     const index = currentLimitsValues.findIndex(lv => lv.alarm_num === alarmNum);
        if (index !== -1) {
            currentLimitsValues[index] = {
                ...currentLimitsValues[index],
                ...collectedValues
            };



  
write data read data boxes too big on target page ( scrolling)
done duplicate entries in the Json lists
done save json button not working on the target page
need file <-> json on target page

export json from target page
http://192.168.86.51:9100/api/alarms/export-json
config: {,â€¦}
directory: "hithium"
file_name: "alarm_config.json"
version: "0.42.1"

import json to target page
http://192.168.86.51:9100/api/alarms/import-json
directory: "hithium"
file_name: "alarm_config.json"
version: "0.42.1"
def2.Json
 cat var_lists/hithium_def2.json
[
    {
        "table": "target_vars",
        "items": [
            {"name": "online","sm_name": "rtos","reg_type": "mb_hold","offset": "online","num": 4,"write_data": [2,3,4,5],"read_data": []},
            {"name": "comms","sm_name": "rtos","reg_type": "mb_input","offset": "rack_voltage","num": 4,"write_data": [3,4,5],"read_data": []},
            {"name": "online","sm_name": "sbmu","reg_type": "sm16","offset": "0x4567","num": 4,"write_data": [2,3,4,5],"read_data": []},
            {"name": "rtos:hold:alarm_limits","sm_name": "rtos","reg_type": "mb_hold","offset": "9","num": 4,"write_data": [1,2,3],"read_data": []},
            {"name": "rtos:hold:alarm_limits","sm_name": "rtos","reg_type": "mb_hold","offset": "9","num": 4,"write_data": [7,8,9],"read_data": []},
            {"name": "rtos:hold:alarm_limits","sm_name": "rtos","reg_type": "mb_hold","offset": "9","num": 4,"write_data": [10,11,12],"read_data": []}
        ]
 

def4.json
 cat var_lists/hithium_def4.json
{"file_name":"hithium_def4.json",
"data":[{
     "table":"vars","items":[
        {"name":"online","sm_name":"rtos","reg_type":"mb_hold","offset":"online","num":4,"write_data":[2,3,4,5]},
        {"name":"comms","sm_name":"rtos","reg_type":"mb_input","offset":"rack_voltage","num":4,"write_data":[3,4,5]},
        {"name":"online","sm_name":"sbmu","reg_type":"sm16","offset":"0x4567","num":4,"write_data":[2,3,4,5]},
        {"name":"rtos:hold:alarm_limits","sm_name":"rtos","reg_type":"mb_hold","offset":"9","num":4,"write_data":[1,2,3]},
        {"name":"rtos:hold:alarm_limits","sm_name":"rtos","reg_type":"mb_hold","offset":"9","num":4,"write_data":[7,8,9]},
        {"name":"rtos:hold:alarm_limits","sm_name":"rtos","reg_type":"mb_hold","offset":"9","num":4,"write_data":[10,11,12]}
        ]}]}



interface with 9001

{"help": "examples"}
{"action":"get", "seq": 123, "sm_name": "test", "reg_type": "mb_input", "offset":1000, "num":10}
{"action":"get", "seq": 123, "sm_name": "sbmu", "reg_type": "sm16", "offset":0, "num":10}
{"action":"get", "seq": 124, "sm_name": "rtos_0", "reg_type": "mb_input", "offset":1000, "num":10}
{"action":"set", "seq": 125, "sm_name": "rtos_0", "reg_type": "mb_hold", "offset":1000, "data":[101,102,103]}
{"action":"get", "seq": 126, "sm_name": "rtos_0", "reg_type": "sm16", "offset":"0xc800", "num":64}
{"action":"get", "seq": 126, "sm_name": "rtos_0", "reg_type": "sm8", "offset":0, "num":64}
{"action":"get", "seq": 126, "sm_name": "rack_0", "reg_type": "sm8", "offset":0, "num":64}
{"action":"set", "seq": 126, "sm_name": "rtos_0", "reg_type": "mb_hold","note":"HV ON", "offset":99, "data":[1,85]}
{"action":"set", "seq": 126, "sm_name": "rtos_0", "reg_type": "mb_hold","note":"HV OFF", "offset":99, "data":[1,170]}
{"action":"set", "seq": 126, "sm_name": "rtos_0", "reg_type": "mb_hold","note":"Relay Ctrl #1", "offset":99, "data":[3]}
{"action":"set", "seq": 126, "sm_name": "rtos_0", "reg_type": "mb_hold","note":"Relay Ctrl #2", "offset":101, "data":[255]}
{"action":"get", "seq": 124, "sm_name": "rack_2", "reg_type": "sm16","note":"comms state", "offset":26626, "num":82}
{"action":"set", "seq": 124, "sm_name": "rtos_2", "reg_type": "rack_config", "offset":"8", "num":64 ,"operation":33, "data":[0], "debug":true}
{"action":"set", "seq": 124, "sm_name": "rtos_2", "reg_type": "rack_status", "offset":"8", "num":64 ,"operation":33, "data":[0], "debug":true}
{"action":"set", "seq": 124, "sm_name": "rtos_2", "reg_type": "can", "offset":"0x1832", "num":8 , "data":[0,1,2,3,4,5,6,7], "debug":true}
{"action":"get", "seq": 124, "sm_name": "rack_2", "reg_type": "mb_input", "offset":500, "num":100, "note":"pole_temp"}
{"action":"get", "seq": 124, "sm_name": "rack_2", "reg_type": "mb_input", "offset":3480, "num":40, "note":"module_soc"}
{"action":"get", "seq": 124, "sm_name": "rack_2", "reg_type": "mb_input", "offset":3560, "num":40, "note":"module_volt"}
{"action":"get", "seq": 124, "sm_name": "rack_2", "reg_type": "mb_input", "offset":3600, "num":40, "note":"module_temp"}
{"action":"get", "seq": 123, "sm_name": "sbmu", "reg_type": "sm16", "offset":"0x3f800", "num":10, "note":"sbmu event buf"}
{"action":"get", "seq": 124, "sm_name": "sbmu", "reg_type": "sm16", "offset":188680, "num":32, "note":"sbmu gpios"}
{"action":"get","sm_name":"sbmu","reg_type":"sm16","offset":"sdul-60a_current_temp_2_1","num":9,"seq":123}
{"action":"set", "seq":123, "sm_name":"r485", "reg_type":"mb_hold", "offset":"env_Status_bits_3_1", "num":1, "note":"rs485 write", "data":[35]}
{"action":"get","sm_name":"sbmu","reg_type":"sm16","offset":"pcs_data","note":"pcs can data","num":9,"seq":123}
{"action":"getPub", "name":"racks","path":"hithium.periodic","rate":1000, "note":" starts to pub the tpath.periodic table every second"}
{"action":"getPub", "name":"racks","path":"hithium.periodic","rate":0, "note":" stops the tpath.periodic pub"}
{"action":"addItem", "path":"hithium.periodic", "item": {"name":"AvgCellV", "src":"rtos:input:avg_voltage", "scale":0.001, "fmt":"%3.2f", "type":"float"}
> tables
< [":sm16" "local:none" "rack:sm16" "rack:sm8" "rtos:bits" "rtos:hold" "rtos:input" "rtos:sm16" "rtos:sm8" "sbmu:bits" "sbmu:hold" "sbmu:input" "sbmu:sm16" "sbmu:sm8" ]
> pubs  todo
< {"error": "parse"}
